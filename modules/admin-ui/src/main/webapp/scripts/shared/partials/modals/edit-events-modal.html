<section ng-form="editEventsForm" ng-show="open" ng-keyup="keyUp($event)" tabindex="1" class="modal wizard modal-animation ng-hide" ng-controller="EditEventsCtrl">
    <header>
        <a class="fa fa-times close-modal" ng-click="close()"></a>
        <h2 translate="BULK_ACTIONS.EDIT_EVENTS.CAPTION"><!-- Template --></h2>
    </header>
    <wizard edit-mode="false" name="editEventsWz" on-finish="submit()" template="shared/partials/wizardNav.html">
        <wz-step wz-title="General" canexit="editEventsForm.generalForm.$valid" wz-disabled="!editEventsForm.generalForm.$valid" ng-form="generalForm" novalidate>
            <!-- First Step: General -->
            <div class="modal-content active">
                <div class="modal-body">
                    <div class="row">
                        <div ng-show="editEventsForm.generalForm.$error.scheduledEvent" class="alert sticky warning">
                            <p translate="BULK_ACTIONS.EDIT_EVENTS.GENERAL.CANNOTSTART">
                                <!-- Cannot start -->
                            </p>
                        </div>
                        <div data-notifications="edit-events"/>
                    </div>
                    <div class="full-col">
                        <div class="obj tbl-list">
                            <header translate="BULK_ACTIONS.EDIT_EVENTS.GENERAL.CAPTION">
                                <span class="header-value" translate="BULK_ACTIONS.EDIT_EVENTS.GENERAL.SUMMARY" translate-values='{ count: rows.length}'>
                                </span>
                            </header>
                            <div class="obj-container">
                                <table class="main-tbl">
                                    <thead>
                                    <tr>
                                        <th class="small"><input type="checkbox" ng-model="allSelected" ng-change="allSelectedChanged(allSelected)" class="select-all-cbox"></th>
                                        <th class="full-width" translate="EVENTS.EVENTS.TABLE.TITLE">
                                            <!-- Title -->
                                        </th>
                                        <th class="full-width" translate="EVENTS.EVENTS.TABLE.SERIES">
                                            <!-- Series -->
                                        </th>
                                        <th class="full-width" translate="EVENTS.EVENTS.TABLE.WORKFLOW_STATE">
                                            <!-- Progress -->
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody >
                                    <tr ng-repeat="row in rows" ng-form="rowsForm" ng-class="{error: rowsForm.selection.$error.scheduledEvent}">
                                        <td><input name="selection" ng-required="!hasAnySelected()" type="checkbox" scheduled-event="{{row.source}}" ng-model="row.selected" ng-change="rowSelectionChanged($index)" class="child-cbox"></td>
                                        <td>{{ row.title }}</td>
                                        <td>{{ row.series_name}}</td>
                                        <td>{{ row.source }}</td>
                                    </tr>
                                    </tbody>
                                </table>

                            </div><!-- obj-container -->

                        </div><!-- obj -->

                    </div>

                </div>

            </div><!-- modal-content [general] -->

            <footer>
                <a wz-next class="submit"
                   ng-class="{active: editEventsForm.generalForm.$valid, disabled: editEventsForm.generalForm.$invalid}">
                    {{ 'WIZARD.NEXT_STEP' | translate }}
                </a>
            </footer>
        </wz-step>

        <!-- Second Step: The actual Editing -->
        <wz-step wz-title="{{ 'BULK_ACTIONS.EDIT_EVENTS.EDIT.CAPTION' | translate }}" ng-form="editEventsForm" novalidate canexit="editEventsForm.$valid">
            <div class="modal-content active">

                <div class="modal-body">
                    <div class="full-col">

                        <div class="obj list-obj">
                            <header translate="BULK_ACTIONS.EDIT_EVENTS.EDIT.METADATA"><!-- Edit Metadata --></header>
                            <div class="obj-container">

                              <table class="main-tbl">
                                <tr ng-repeat="row in metadataRows track by $index">
                                  <td>
                                    <span translate="{{ row.label }}"></span>
                                    <i ng-show="row.required" class="required">*</i>
                                  </td>
                                  <td admin-ng-editable
                                      required-role="ROLE_UI_EVENTS_DETAILS_METADATA_EDIT"
                                      params="row"
                                      save="saveField">
                                  </td>
                                </tr>
                              </table>

                            </div><!-- obj-container -->

                        </div><!--list-obj -->

                        <div class="obj list-obj">
                            <header translate="BULK_ACTIONS.EDIT_EVENTS.EDIT.SCHEDULING"><!-- Edit scheduling --></header>
                            <div class="obj-container">

                              <!-- Scheduling configuration -->
                              <div class="obj tbl-details">
                                <header>
                                  <span translate="EVENTS.EVENTS.DETAILS.SCHEDULING.CAPTION">
                                    <!-- Scheduling configuration -->
                                  </span>
                                </header>
                                <div class="obj-container">
                                  <table class="main-tbl">
                                    <tr>
                                      <td>{{ 'EVENTS.EVENTS.DETAILS.SOURCE.DATE_TIME.TIMEZONE' | translate }}</td>
                                      <td>{{ tz }}</td>
                                    </tr>
                                    <tr>
                                      <td>{{ 'EVENTS.EVENTS.DETAILS.SOURCE.DATE_TIME.START_TIME' | translate }}</td>
                                      <td ng-if="$root.userIs('ROLE_UI_EVENTS_DETAILS_SCHEDULING_EDIT')">
                                        <select chosen
                                                ng-disabled="checkingConflicts"
                                                data-width="'100px'"
                                                data-disable-search-threshold="8"
                                                ng-model="scheduling.start.hour" ng-change="onTemporalValueChange('start')"
                                                data-placeholder="{{ 'EVENTS.EVENTS.DETAILS.SOURCE.PLACEHOLDER.HOUR' | translate}}"
                                                ng-options="h.index as h.value for h in hours"
                                                />
                                        <select chosen
                                                ng-disabled="checkingConflicts"
                                                data-width="'100px'"
                                                data-disable-search-threshold="8"
                                                ng-model="scheduling.start.minute" ng-change="onTemporalValueChange('start')"
                                                data-placeholder="{{ 'EVENTS.EVENTS.DETAILS.SOURCE.PLACEHOLDER.MINUTE' | translate}}"
                                                ng-options="m.index as m.value for m in minutes"
                                                />
                                      </td>
                                      <td ng-if="!$root.userIs('ROLE_UI_EVENTS_DETAILS_SCHEDULING_EDIT')">
                                        {{ source.start.hour | addLeadingZeros : 2 }} : {{ source.start.minute | addLeadingZeros : 2}}
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>{{ 'EVENTS.EVENTS.DETAILS.SOURCE.DATE_TIME.DURATION' | translate }}</td>
                                      <td ng-if="$root.userIs('ROLE_UI_EVENTS_DETAILS_SCHEDULING_EDIT')">
                                        <select chosen
                                                ng-disabled="checkingConflicts"
                                                data-width="'100px'"
                                                data-disable-search-threshold="8"
                                                ng-model="scheduling.duration.hour" ng-change="onTemporalValueChange('duration')"
                                                data-placeholder="{{ 'WIZARD.DURATION.HOURS' | translate }}"
                                                ng-options="h.index as h.value for h in hours"
                                                />

                                        <select chosen
                                                ng-disabled="checkingConflicts"
                                                data-width="'100px'"
                                                data-disable-search-threshold="8"
                                                ng-model="scheduling.duration.minute" ng-change="onTemporalValueChange('duration')"
                                                data-placeholder="{{ 'WIZARD.DURATION.MINUTES' | translate }}"
                                                ng-options="m.index as m.value for m in minutes"
                                                />
                                      </td>
                                      <td ng-if="!$root.userIs('ROLE_UI_EVENTS_DETAILS_SCHEDULING_EDIT')">
                                        {{ scheduling.duration.hour | addLeadingZeros : 2 }} : {{ scheduling.duration.minute | addLeadingZeros : 2}}
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>{{ 'EVENTS.EVENTS.DETAILS.SOURCE.DATE_TIME.END_TIME' | translate }}</td>
                                      <td ng-if="$root.userIs('ROLE_UI_EVENTS_DETAILS_SCHEDULING_EDIT')">
                                        <select chosen
                                                ng-disabled="checkingConflicts"
                                                data-width="'100px'"
                                                data-disable-search-threshold="8"
                                                ng-model="scheduling.end.hour" ng-change="onTemporalValueChange('end')"
                                                data-placeholder="{{ 'EVENTS.EVENTS.DETAILS.SOURCE.PLACEHOLDER.HOUR' | translate}}"
                                                ng-options="h.index as h.value for h in hours"
                                                />
                                        <select chosen
                                                ng-disabled="checkingConflicts"
                                                data-width="'100px'"
                                                data-disable-search-threshold="8"
                                                ng-model="scheduling.end.minute" ng-change="onTemporalValueChange('end')"
                                                data-placeholder="{{ 'EVENTS.EVENTS.DETAILS.SOURCE.PLACEHOLDER.MINUTE' | translate}}"
                                                ng-options="m.index as m.value for m in minutes"
                                                />
                                        <span ng-bind="scheduling.end.date"
                                              ng-show="scheduling.end.date !== scheduling.start.date"
                                              />
                                      </td>
                                      <td ng-if="!$root.userIs('ROLE_UI_EVENTS_DETAILS_SCHEDULING_EDIT')">
                                        {{ scheduling.end.hour | addLeadingZeros : 2 }} : {{ scheduling.end.minute | addLeadingZeros : 2}}
                                        <span ng-bind="scheduling.end.date"
                                              ng-show="scheduling.end.date !== scheduling.start.date"
                                              />
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>{{ 'EVENTS.EVENTS.DETAILS.SOURCE.PLACEHOLDER.LOCATION' | translate }}</td>
                                      <td ng-if="$root.userIs('ROLE_UI_EVENTS_DETAILS_SCHEDULING_EDIT')">
                                        <select chosen pre-select-from="captureAgents"
                                                ng-disabled="checkingConflicts"
                                                data-width="'200px'"
                                                ng-change="roomChanged(); saveScheduling()"
                                                data-disable-search-threshold="8"
                                                ng-model="scheduling.location"
                                                ng-options="value.name for (id, value) in captureAgents"
                                                data-placeholder="{{ 'EVENTS.EVENTS.DETAILS.SOURCE.PLACEHOLDER.LOCATION' | translate }}"
                                                />
                                      </td>
                                      <td ng-if="!$root.userIs('ROLE_UI_EVENTS_DETAILS_SCHEDULING_EDIT')">
                                        {{ source.device.name }}
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>{{ 'EVENTS.EVENTS.DETAILS.SOURCE.PLACEHOLDER.INPUTS' | translate }}</td>
                                      <td>
                                        <label ng-repeat="inputMethod in source.device.inputs">
                                          <input type="checkbox"
                                                 ng-change="saveScheduling()"
                                                 ng-model="source.device.inputMethods[inputMethod.id]"
                                                 ng-disabled="checkingConflicts || !$root.userIs('ROLE_UI_EVENTS_DETAILS_SCHEDULING_EDIT')"> {{ inputMethod.value | translate }}
                                          <br>
                                        </label>
                                      </td>
                                    </tr>
                                  </table>
                                </div>

                              </div>

                            </div><!-- obj-container -->

                        </div><!--list-obj -->
                    </div><!-- full-col-->
                </div><!-- modal-body -->
            </div><!-- modal-content [task] -->
            <footer>
                <a wz-next class="submit"
                   ng-class="{active: editEventsForm.$valid, inactive: editEventsForm.$invalid}">
                    {{ 'WIZARD.NEXT_STEP' | translate }}
                </a>
                <a wz-previous translate="WIZARD.BACK" class="cancel">
                </a>
            </footer>
        </wz-step>

        <!-- Third step: Summary -->
        <wz-step wz-title="{{ 'BULK_ACTIONS.EDIT_EVENTS.SUMMARY.CAPTION' | translate }}" novalidate canexit="true">
            <div class="modal-content active">
                <div class="modal-body">
                    <div class="full-col">
                        <div class="obj list-obj">
                            <header translate="BULK_ACTIONS.EDIT_EVENTS.SUMMARY.CAPTION"><!-- Summary --></header>
                            <div class="obj-container">
                            </div><!-- obj-container -->
                        </div>
                    </div>

                </div>
            </div><!-- modal-content [summary] -->
            <footer>
                <a wz-next class="submit"
                   ng-class="{active: editEventsForm.$valid, inactive: editEventsForm.$invalid, disabled: submitButton}">
                    {{ 'WIZARD.CREATE' | translate }}
                </a>
                <a wz-previous translate="WIZARD.BACK" class="cancel">
                </a>
            </footer>
        </wz-step>

    </wizard>


    <div class="btm-spacer"></div>
</section>
